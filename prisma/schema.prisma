// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// User model - synced with Clerk
model User {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  clerkId       String   @unique
  email         String
  username      String?  @unique
  displayName   String?
  avatarUrl     String?
  bio           String?
  
  // Activity visibility settings
  activityVisibility String @default("PUBLIC") // "PUBLIC", "FOLLOWERS_ONLY", "PRIVATE"
  showRatingsInActivity Boolean @default(true)
  showReviewsInActivity Boolean @default(true)
  showListsInActivity Boolean @default(true)
  showPlaylistsInActivity Boolean @default(true)
  showWatchedInActivity Boolean @default(true)
  showLikedInActivity Boolean @default(true)
  showFollowedInActivity Boolean @default(true)
  
  // Notification preferences
  emailNotifications Boolean @default(true)
  pushNotifications Boolean @default(true)
  notifyOnNewFollowers Boolean @default(true)
  notifyOnNewReviews Boolean @default(true)
  notifyOnListUpdates Boolean @default(true)
  notifyOnPlaylistUpdates Boolean @default(true)
  notifyOnActivityLikes Boolean @default(true)
  notifyOnMentions Boolean @default(true)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  preferences   UserPreferences?
  favorites     Favorite[]
  playlists     Playlist[]
  reviews       Review[]
  reviewReactions ReviewReaction[]
  reviewReports ReviewReport[]
  forumPosts    ForumPost[]
  forumReplies  ForumReply[]
  sharedPlaylists SharedPlaylist[]
  recentlyViewed RecentlyViewed[]
  viewingLogs   ViewingLog[]
  playlistEngagements PlaylistEngagementEvent[] @relation("UserPlaylistEngagementOwnership")
  playlistEngagementActions PlaylistEngagementEvent[] @relation("UserPlaylistEngagementActor")
  listEngagements ListEngagementEvent[] @relation("UserListEngagementOwnership")
  listEngagementActions ListEngagementEvent[] @relation("UserListEngagementActor")
  aiChatEvents AiChatEvent[]
  aiChatSessions AiChatSession[]
  
  // Social features
  followers     Follow[] @relation("UserFollowers")
  following     Follow[] @relation("UserFollowing")
  likedPlaylists LikedPlaylist[]
  viewingLogComments ViewingLogComment[]
  commentReactions CommentReaction[]
  watchlistItems WatchlistItem[]
  channelWatchlistItems ChannelWatchlistItem[]
  favoriteChannels FavoriteChannel[]
  youtubeVideoFavorites YouTubeVideoFavorite[]
  youtubeVideoWatchlistItems YouTubeVideoWatchlistItem[]
  youtubeNotifications YouTubeNotification[]
  youtubeVideoViews YouTubeVideoView[]
  activities Activity[]
  followedActivities Activity[] @relation("UserFollowedActivities")
  lists List[]
  likedLists LikedList[]
  listComments ListComment[]
  listCommentReactions ListCommentReaction[]

  @@map("users")
}

// User preferences from onboarding
model UserPreferences {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  userId            String   @unique @db.ObjectId
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Genre preferences (stored as array of genre IDs from TMDB)
  favoriteGenres    Int[]    @default([])
  dislikedGenres    Int[]    @default([])
  
  // Content preferences
  preferredTypes    String[] @default([]) // ["movie", "tv"]
  minRating         Float?    // Minimum rating user wants to see
  preferredLanguages String[] @default([]) // ISO 639-1 codes
  
  // Release year preferences
  minYear           Int?
  maxYear           Int?
  
  // Onboarding completed flag
  onboardingCompleted Boolean @default(false)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("user_preferences")
}

// Favorites - movies and TV shows user likes
model Favorite {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // TMDB data
  tmdbId        Int      // Movie or TV show ID from TMDB
  mediaType     String   // "movie" or "tv"
  title         String
  posterPath    String?
  backdropPath String?
  releaseDate   String?  // For movies
  firstAirDate  String?  // For TV shows
  
  createdAt     DateTime @default(now())

  @@unique([userId, tmdbId, mediaType])
  @@map("favorites")
  @@index([userId])
}

// Watchlist - movies and TV shows user wants to watch
model WatchlistItem {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // TMDB data
  tmdbId        Int      // Movie or TV show ID from TMDB
  mediaType     String   // "movie" or "tv"
  title         String
  posterPath    String?
  backdropPath  String?
  releaseDate   String?  // For movies
  firstAirDate  String?  // For TV shows
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([userId, tmdbId, mediaType])
  @@map("watchlist_items")
  @@index([userId])
  @@index([createdAt])
}

enum PlaylistVisibility {
  PUBLIC
  FOLLOWERS_ONLY
  PRIVATE
}

// Playlists - user-created collections
model Playlist {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name          String
  description   String?
  isPublic      Boolean  @default(false) // Deprecated, use visibility instead
  visibility    PlaylistVisibility @default(PRIVATE)
  coverImage    String?  // URL to cover image
  likesCount    Int      @default(0) // Number of users who liked this playlist
  
  items         PlaylistItem[]
  youtubeItems  YouTubePlaylistItem[]
  sharedPlaylists SharedPlaylist[]
  engagementEvents PlaylistEngagementEvent[]
  likedBy       LikedPlaylist[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("playlists")
  @@index([userId])
  @@index([isPublic])
  @@index([visibility])
  @@index([likesCount])
}

// Items in a playlist
model PlaylistItem {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  playlistId    String   @db.ObjectId
  playlist      Playlist @relation(fields: [playlistId], references: [id], onDelete: Cascade)
  
  // TMDB data
  tmdbId        Int
  mediaType     String   // "movie" or "tv"
  title         String
  posterPath    String?
  backdropPath String?
  releaseDate   String?
  firstAirDate  String?
  
  // Order in playlist
  order         Int      @default(0)
  
  createdAt     DateTime @default(now())

  @@map("playlist_items")
  @@index([playlistId])
  @@unique([playlistId, tmdbId, mediaType])
}

enum PlaylistEngagementType {
  SHARE
  VISIT
}

model PlaylistEngagementEvent {
  id           String                   @id @default(auto()) @map("_id") @db.ObjectId
  playlistId   String                   @db.ObjectId
  playlist     Playlist                 @relation(fields: [playlistId], references: [id], onDelete: Cascade)
  ownerId      String                   @db.ObjectId
  owner        User                     @relation("UserPlaylistEngagementOwnership", fields: [ownerId], references: [id], onDelete: Cascade)
  actorId      String?                  @db.ObjectId
  actor        User?                    @relation("UserPlaylistEngagementActor", fields: [actorId], references: [id])
  type         PlaylistEngagementType
  source       String?
  visitorToken String?
  metadata     Json?
  createdAt    DateTime                 @default(now())

  @@map("playlist_engagement_events")
  @@index([playlistId])
  @@index([ownerId, type])
  @@index([visitorToken])
}

// Reviews - user reviews for movies/TV shows
model Review {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // TMDB data
  tmdbId        Int
  mediaType     String   // "movie" or "tv"
  
  rating        Int      // 1-10 rating
  title         String?  // Review title
  content       String   // Review text
  containsSpoilers Boolean @default(false) // Whether review contains spoilers
  
  // Engagement
  helpful       Int      @default(0)
  isFeatured    Boolean  @default(false) // Featured reviews shown first
  
  reactions     ReviewReaction[]
  reports       ReviewReport[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([userId, tmdbId, mediaType])
  @@map("reviews")
  @@index([userId])
  @@index([tmdbId, mediaType])
  @@index([createdAt])
  @@index([isFeatured, createdAt])
  @@index([rating])
}

// Review reactions - likes and emoji reactions
model ReviewReaction {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  reviewId      String   @db.ObjectId
  review        Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Reaction type: "like", "helpful", or emoji string (e.g., "üëç", "‚ù§Ô∏è", "üòÇ")
  reactionType  String   // "like", "helpful", or emoji unicode
  
  createdAt     DateTime @default(now())

  @@unique([reviewId, userId, reactionType])
  @@map("review_reactions")
  @@index([reviewId])
  @@index([userId])
  @@index([reactionType])
}

// Review reports - user reports for inappropriate reviews
model ReviewReport {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  reviewId      String   @db.ObjectId
  review        Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  reason        String   // Report reason (spam, harassment, etc.)
  description   String?  // Optional additional details
  
  createdAt     DateTime @default(now())

  @@unique([reviewId, userId])
  @@map("review_reports")
  @@index([reviewId])
  @@index([userId])
  @@index([createdAt])
}

// Forum posts - discussion threads
model ForumPost {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title         String
  content       String
  
  // Optional TMDB link
  tmdbId        Int?
  mediaType     String?  // "movie" or "tv"
  
  // Categories/Tags
  tags          String[] @default([])
  
  // Engagement
  views         Int      @default(0)
  likes         Int      @default(0)
  
  replies       ForumReply[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("forum_posts")
  @@index([userId])
  @@index([tmdbId, mediaType])
  @@index([createdAt])
}

// Forum replies - comments on forum posts
model ForumReply {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  postId        String   @db.ObjectId
  post          ForumPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  
  content       String
  
  // Optional reply to another reply
  parentReplyId String?  @db.ObjectId
  
  likes         Int      @default(0)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("forum_replies")
  @@index([postId])
  @@index([userId])
}

// Shared playlists - tracking who shared playlists with whom
model SharedPlaylist {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  playlistId    String   @db.ObjectId
  playlist      Playlist @relation(fields: [playlistId], references: [id], onDelete: Cascade)
  
  sharedById    String   @db.ObjectId
  sharedBy      User     @relation(fields: [sharedById], references: [id], onDelete: Cascade)
  
  // Optional: shared with specific user (if null, public share)
  sharedWithId  String?  @db.ObjectId
  
  shareToken    String   @unique // For public sharing via link
  
  createdAt     DateTime @default(now())

  @@map("shared_playlists")
  @@index([playlistId])
  @@index([sharedById])
}

// Recently Viewed - tracks movies and TV shows user has viewed
model RecentlyViewed {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // TMDB data
  tmdbId        Int      // Movie or TV show ID from TMDB
  mediaType     String   // "movie" or "tv"
  title         String
  posterPath    String?
  backdropPath  String?
  releaseDate   String?  // For movies
  firstAirDate  String?  // For TV shows
  
  viewedAt      DateTime @default(now())
  
  @@map("recently_viewed")
  @@index([userId])
  @@index([userId, viewedAt])
  @@unique([userId, tmdbId, mediaType])
}

// Viewing Log - Film Diary: tracks when user watched movies/TV shows with dates and notes
// Allows multiple viewings of the same film
model ViewingLog {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // TMDB data
  tmdbId        Int      // Movie or TV show ID from TMDB
  mediaType     String   // "movie" or "tv"
  title         String
  posterPath    String?
  backdropPath  String?
  releaseDate   String?  // For movies
  firstAirDate  String?  // For TV shows
  
  // Diary entry
  watchedAt     DateTime // When the user watched it (can be in the past)
  notes         String?  // Optional notes about this viewing
  rating        Int?     // 1-5 star rating (optional)
  tags          String[] @default([]) // Tags for grouping (e.g., Netflix, horror)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  comments      ViewingLogComment[]
  
  @@map("viewing_logs")
  @@index([userId])
  @@index([userId, watchedAt])
  @@index([tmdbId, mediaType])
}

// Comments on viewing logs (reviews)
model ViewingLogComment {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  viewingLogId  String   @db.ObjectId
  viewingLog    ViewingLog @relation(fields: [viewingLogId], references: [id], onDelete: Cascade)
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  content       String
  
  // Nested replies
  parentCommentId String? @db.ObjectId
  parentComment   ViewingLogComment? @relation("CommentReplies", fields: [parentCommentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  replies         ViewingLogComment[] @relation("CommentReplies")
  
  likes         Int      @default(0)
  reactions     CommentReaction[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("viewing_log_comments")
  @@index([viewingLogId])
  @@index([userId])
  @@index([parentCommentId])
  @@index([createdAt])
}

// Comment reactions - likes and emoji reactions
model CommentReaction {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  commentId     String   @db.ObjectId
  comment       ViewingLogComment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Reaction type: "like" or emoji string (e.g., "üëç", "‚ù§Ô∏è", "üòÇ")
  reactionType  String   // "like" or emoji unicode
  
  createdAt     DateTime @default(now())

  @@unique([commentId, userId, reactionType])
  @@map("comment_reactions")
  @@index([commentId])
  @@index([userId])
  @@index([reactionType])
  @@index([createdAt])
}

enum AiChatIntent {
  RECOMMENDATION
  INFORMATION
}

model AiChatEvent {
  id            String        @id @default(auto()) @map("_id") @db.ObjectId
  userId        String        @db.ObjectId
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Chat session tracking
  sessionId     String        // Unique session identifier for grouping messages
  
  // User message
  userMessage   String        // The user's query/message
  intent        AiChatIntent  // RECOMMENDATION or INFORMATION
  
  // AI response metadata
  aiResponse    String?       // The AI's text response
  responseTime  Int?          // Response time in milliseconds
  
  // Results data
  resultsCount  Int           @default(0) // Number of movies/TV shows returned
  resultIds     Int[]         @default([]) // TMDB IDs of results
  resultTypes   String[]      @default([]) // "movie" or "tv" for each result
  
  // Query metadata
  extractedGenres    Int[]    @default([]) // Genres extracted from query
  extractedKeywords  String[] @default([]) // Keywords extracted from query
  extractedYear      Int?     // Year filter if extracted
  extractedType      String?  // "movie" or "tv" if specified
  
  // User interaction
  resultsClicked   Int       @default(0) // How many results user clicked
  resultsAddedToPlaylist Int @default(0) // How many results added to playlist
  
  // Error tracking
  errorMessage  String?
  
  createdAt     DateTime      @default(now())

  @@map("ai_chat_events")
  @@index([userId])
  @@index([userId, createdAt])
  @@index([sessionId])
  @@index([intent])
}

// Chat sessions for persisting conversation history
model AiChatSession {
  id            String        @id @default(auto()) @map("_id") @db.ObjectId
  userId        String        @db.ObjectId
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  sessionId     String        @unique // Unique session identifier
  mode          String        // "recommendation" or "information"
  title         String?       // Auto-generated or user-provided title
  messages      Json          // Array of chat messages
  metadata      Json?         // Additional metadata (results, etc.)
  
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@map("ai_chat_sessions")
  @@index([userId])
  @@index([userId, updatedAt])
}

// Follow system - users following each other
model Follow {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  followerId    String   @db.ObjectId
  follower      User     @relation("UserFollowers", fields: [followerId], references: [id], onDelete: Cascade)
  followingId   String   @db.ObjectId
  following     User     @relation("UserFollowing", fields: [followingId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime @default(now())

  @@unique([followerId, followingId])
  @@map("follows")
  @@index([followerId])
  @@index([followingId])
  @@index([createdAt])
}

// Liked playlists - playlists users have liked (auto-saved to their library)
model LikedPlaylist {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  playlistId    String   @db.ObjectId
  playlist      Playlist @relation(fields: [playlistId], references: [id], onDelete: Cascade)
  
  // Read-only flag (always true for liked playlists from others)
  isReadOnly    Boolean  @default(true)
  
  createdAt     DateTime @default(now())

  @@unique([userId, playlistId])
  @@map("liked_playlists")
  @@index([userId])
  @@index([playlistId])
  @@index([createdAt])
}

// Activity Feed - tracks user actions for social feed
enum ActivityType {
  LOGGED_FILM      // User logged a film to diary
  RATED_FILM       // User rated a film
  REVIEWED_FILM    // User wrote a review/notes
  LIKED_FILM       // User liked a film
  CREATED_LIST     // User created a list
  CREATED_PLAYLIST // User created a playlist
  FOLLOWED_USER    // User followed someone
}

model Activity {
  id            String       @id @default(auto()) @map("_id") @db.ObjectId
  userId        String       @db.ObjectId
  user          User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type          ActivityType
  
  // Optional: related content (film, list, playlist, user)
  tmdbId        Int?         // For film-related activities
  mediaType     String?      // "movie" or "tv"
  title         String?      // Film title
  posterPath    String?      // Film poster
  
  // For list/playlist activities
  listId        String?      @db.ObjectId
  listName      String?      // List/playlist name
  
  // For follow activities
  followedUserId String?     @db.ObjectId
  followedUser   User?       @relation("UserFollowedActivities", fields: [followedUserId], references: [id], onDelete: Cascade)
  
  // Additional metadata
  rating        Int?         // For rating activities
  metadata      Json?        // Additional flexible data
  
  // Privacy settings
  visibility    String?      // "PUBLIC", "FOLLOWERS_ONLY", "PRIVATE" - inherits from user settings if null
  
  createdAt     DateTime     @default(now())
  
  @@map("activities")
  @@index([userId, createdAt])
  @@index([userId, type])
  @@index([createdAt])
  @@index([tmdbId, mediaType])
}

// Lists - user-created ranked lists (different from playlists)
enum ListVisibility {
  PUBLIC
  FOLLOWERS_ONLY
  PRIVATE
}

model List {
  id            String       @id @default(auto()) @map("_id") @db.ObjectId
  userId        String       @db.ObjectId
  user          User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name          String
  description   String?
  visibility    ListVisibility @default(PRIVATE)
  tags          String[]     @default([])
  coverImage    String?      // URL to cover image
  
  // Moderation - users blocked from commenting
  blockedUsers  String[]     @default([]) // Array of user IDs
  
  items         ListItem[]
  likedBy       LikedList[]
  comments      ListComment[]
  engagementEvents ListEngagementEvent[]
  
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  
  @@map("lists")
  @@index([userId])
  @@index([visibility])
  @@index([createdAt])
}

// Items in a list (with ranking/position)
model ListItem {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  listId        String   @db.ObjectId
  list          List     @relation(fields: [listId], references: [id], onDelete: Cascade)
  
  // TMDB data
  tmdbId        Int
  mediaType     String   // "movie" or "tv"
  title         String
  posterPath    String?
  backdropPath  String?
  releaseDate   String?
  firstAirDate  String?
  
  // Ranking/position in the list (1-based)
  position      Int      @default(0)
  
  createdAt     DateTime @default(now())
  
  @@map("list_items")
  @@index([listId])
  @@index([listId, position])
  @@unique([listId, tmdbId, mediaType])
}

// Liked Lists - lists that users have liked (PUBLIC or FOLLOWERS_ONLY only)
model LikedList {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  listId        String   @db.ObjectId
  list          List     @relation(fields: [listId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime @default(now())

  @@unique([userId, listId])
  @@map("liked_lists")
  @@index([userId])
  @@index([listId])
  @@index([createdAt])
}

// List Comments - comments on lists
model ListComment {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  listId        String   @db.ObjectId
  list          List     @relation(fields: [listId], references: [id], onDelete: Cascade)
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  content       String
  
  // Nested replies
  parentCommentId String? @db.ObjectId
  parentComment   ListComment? @relation("ListCommentReplies", fields: [parentCommentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  replies         ListComment[] @relation("ListCommentReplies")
  
  // Reactions
  reactions     ListCommentReaction[]
  
  likes         Int      @default(0)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("list_comments")
  @@index([listId])
  @@index([userId])
  @@index([parentCommentId])
  @@index([createdAt])
}

// List Comment reactions - likes and emoji reactions
model ListCommentReaction {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  commentId     String   @db.ObjectId
  comment       ListComment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Reaction type: "like" or emoji string (e.g., "üëç", "‚ù§Ô∏è", "üòÇ")
  reactionType  String   // "like" or emoji unicode
  
  createdAt     DateTime @default(now())

  @@unique([commentId, userId, reactionType])
  @@map("list_comment_reactions")
  @@index([commentId])
  @@index([userId])
  @@index([reactionType])
  @@index([createdAt])
}

enum ListEngagementType {
  SHARE
  VISIT
}

model ListEngagementEvent {
  id           String                 @id @default(auto()) @map("_id") @db.ObjectId
  listId       String                 @db.ObjectId
  list         List                   @relation(fields: [listId], references: [id], onDelete: Cascade)
  ownerId      String                 @db.ObjectId
  owner        User                   @relation("UserListEngagementOwnership", fields: [ownerId], references: [id], onDelete: Cascade)
  actorId      String?                @db.ObjectId
  actor        User?                  @relation("UserListEngagementActor", fields: [actorId], references: [id])
  type         ListEngagementType
  source       String?
  visitorToken String?
  metadata     Json?
  createdAt    DateTime               @default(now())

  @@map("list_engagement_events")
  @@index([listId])
  @@index([ownerId, type])
  @@index([visitorToken])
}

// YouTube Channels - Nollywood YouTube channel IDs
model YouTubeChannel {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  channelId     String   @unique // YouTube channel ID (starts with UC)
  slug          String?  @unique // Friendly slug/handle (e.g. @channelname)
  title         String?  // Channel title (optional, can be fetched from API)
  thumbnail     String?  // Channel thumbnail URL (optional)
  channelUrl    String?  // Full YouTube channel URL (optional)
  isActive      Boolean  @default(true) // Whether channel is active/visible
  isPrivate     Boolean  @default(false) // Whether channel is private (only visible to user who added it)
  addedByUserId String?  @db.ObjectId // User who added this channel (null for public channels)
  order         Int      @default(0) // Display order
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("youtube_channels")
  @@index([isActive])
  @@index([isPrivate])
  @@index([addedByUserId])
  @@index([order])
}

// Favorite Channels - User's favorite YouTube channels
model FavoriteChannel {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // YouTube channel data
  channelId     String   // YouTube channel ID (starts with UC)
  slug          String?
  title         String?  // Channel title (cached from API)
  thumbnail     String?  // Channel thumbnail URL (cached)
  channelUrl    String?  // Full YouTube channel URL (cached)
  
  createdAt     DateTime @default(now())

  @@unique([userId, channelId])
  @@map("favorite_channels")
  @@index([userId])
  @@index([createdAt])
}

// Channel Watchlist - YouTube channels user wants to watch later
model ChannelWatchlistItem {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // YouTube channel data
  channelId     String   // YouTube channel ID (starts with UC)
  slug          String?
  title         String?  // Channel title (cached from API)
  thumbnail     String?  // Channel thumbnail URL (cached)
  channelUrl    String?  // Full YouTube channel URL (cached)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([userId, channelId])
  @@map("channel_watchlist_items")
  @@index([userId])
  @@index([createdAt])
}

model YouTubeVideoFavorite {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  videoId       String
  title         String
  thumbnail     String?
  channelId     String
  channelTitle  String?
  duration      String?
  videoUrl      String
  description   String?
  publishedAt   String?
  createdAt     DateTime @default(now())

  @@unique([userId, videoId])
  @@map("youtube_video_favorites")
  @@index([userId])
  @@index([createdAt])
}

model YouTubeVideoWatchlistItem {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  videoId       String
  title         String
  thumbnail     String?
  channelId     String
  channelTitle  String?
  duration      String?
  videoUrl      String
  description   String?
  publishedAt   String?
  createdAt     DateTime @default(now())

  @@unique([userId, videoId])
  @@map("youtube_video_watchlist")
  @@index([userId])
  @@index([createdAt])
}

// YouTube Playlist Items - YouTube videos in user playlists
model YouTubePlaylistItem {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  playlistId    String   @db.ObjectId
  playlist      Playlist @relation(fields: [playlistId], references: [id], onDelete: Cascade)
  
  // YouTube video data
  videoId       String   // YouTube video ID
  title         String
  thumbnail     String?  // Video thumbnail URL
  description   String?  // Video description
  duration      String?  // Video duration (ISO 8601 format)
  publishedAt   String?  // Video publish date
  channelId     String   // Channel ID that owns the video
  channelTitle  String?  // Channel title (cached)
  
  // Order in playlist
  order         Int      @default(0)
  
  createdAt     DateTime @default(now())

  @@map("youtube_playlist_items")
  @@index([playlistId])
  @@unique([playlistId, videoId])
}

// YouTube Notifications - New videos from favorite channels
model YouTubeNotification {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Channel that posted the video
  channelId     String
  channelTitle  String?
  channelThumbnail String?
  
  // Video details
  videoId       String
  videoTitle    String
  videoThumbnail String?
  videoUrl      String
  publishedAt   DateTime
  
  // Notification status
  isRead        Boolean  @default(false)
  readAt        DateTime?
  
  createdAt     DateTime @default(now())

  @@map("youtube_notifications")
  @@index([userId, isRead])
  @@index([userId, createdAt])
  @@index([channelId])
  @@unique([userId, videoId])
}

// YouTube Video Analytics - View tracking and engagement
model YouTubeVideoView {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String?  @db.ObjectId
  user          User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  videoId       String
  channelId     String
  
  // View tracking
  viewDuration  Int?     // Duration watched in seconds
  completed     Boolean  @default(false) // Whether video was watched to completion
  source        String?  // Where the video was viewed from (dashboard, channel, search, etc.)
  
  // Engagement
  liked         Boolean  @default(false)
  addedToWatchlist Boolean @default(false)
  addedToPlaylist Boolean @default(false)
  
  createdAt     DateTime @default(now())

  @@map("youtube_video_views")
  @@index([userId])
  @@index([videoId])
  @@index([channelId])
  @@index([createdAt])
  @@index([userId, createdAt])
}
